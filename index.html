<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <title>Assistente Storopack</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: Inter, sans-serif;
            background: linear-gradient(135deg, #0a1929, #0d2a47, #061e3e);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1100px; margin: 0 auto; }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        .header-left { display: flex; align-items: center; gap: 15px; }
        .logo { height: 60px; border-radius: 8px; background: white; }
        .header-title { color: white; font-size: 18px; font-weight: 700; }
        .header-sub { color: rgba(255,255,255,0.7); font-size: 12px; }
        .header-right { text-align: right; }
        .status { color: #4ade80; font-size: 13px; }
        .phone { color: rgba(255,255,255,0.7); font-size: 13px; margin-top: 5px; }
        .phone b { color: white; }

        .card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            display: grid;
            grid-template-columns: 1.5fr 1fr;
            gap: 30px;
        }
        h1 { color: #0066cc; font-size: 22px; margin-bottom: 5px; }
        .subtitle { color: #666; font-size: 14px; margin-bottom: 15px; }
        
        .hint {
            background: #e8f4fd;
            border-left: 4px solid #0066cc;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 13px;
            color: #0066cc;
            margin-bottom: 15px;
        }

        .badge {
            display: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            color: white;
            margin-bottom: 15px;
            align-items: center;
            gap: 10px;
        }
        .badge.show { display: inline-flex; }
        .badge.airplus { background: #3b82f6; }
        .badge.paperplus { background: #84cc16; }
        .badge.foamplus { background: #f97316; }
        .badge.airmove { background: #8b5cf6; }
        .badge button {
            background: #ef4444;
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
        }
        .badge button:hover { background: #dc2626; }

        .chat {
            background: #f5f5f5;
            border-radius: 12px;
            padding: 15px;
            height: 350px;
            overflow-y: auto;
            margin-bottom: 15px;
        }
        .msg { margin-bottom: 12px; }
        .msg-bot { text-align: left; }
        .msg-user { text-align: right; }
        .msg span {
            display: inline-block;
            padding: 10px 15px;
            border-radius: 12px;
            max-width: 85%;
            font-size: 13px;
            line-height: 1.5;
        }
        .msg-bot span { background: white; border: 1px solid #ddd; }
        .msg-user span { background: linear-gradient(to right, #0ea5e9, #003066); color: white; }

        .modules {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        .mod-btn {
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 12px;
            padding: 0;
            cursor: pointer;
            transition: all 0.2s;
            overflow: hidden;
        }
        .mod-btn:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .mod-btn img { width: 100%; height: 80px; object-fit: contain; background: #f8f8f8; }
        .mod-btn .label {
            padding: 8px;
            text-align: center;
            font-weight: 600;
            font-size: 12px;
            color: white;
        }
        .mod-btn.airplus .label { background: #3b82f6; }
        .mod-btn.paperplus .label { background: #84cc16; }
        .mod-btn.foamplus .label { background: #f97316; }
        .mod-btn.airmove .label { background: #8b5cf6; }
        .mod-btn.airplus:hover { border-color: #3b82f6; }
        .mod-btn.paperplus:hover { border-color: #84cc16; }
        .mod-btn.foamplus:hover { border-color: #f97316; }
        .mod-btn.airmove:hover { border-color: #8b5cf6; }

        .submods {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        .sub-btn {
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            padding: 0;
            cursor: pointer;
            transition: all 0.2s;
            overflow: hidden;
        }
        .sub-btn:hover { border-color: #0066cc; }
        .sub-btn img { width: 100%; height: 50px; object-fit: contain; background: #f8f8f8; }
        .sub-btn .label { padding: 5px; font-size: 10px; font-weight: 600; background: #f1f1f1; }

        .input-row { display: flex; gap: 10px; }
        #msgInput {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
        }
        #msgInput:focus { border-color: #0066cc; }
        #msgInput:disabled { background: #f5f5f5; }
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 13px;
        }
        .btn-primary { background: #0066cc; color: white; }
        .btn-primary:hover { background: #0055aa; }
        .btn-primary:disabled { background: #ccc; cursor: not-allowed; }
        .btn-back { background: #ef4444; color: white; margin-top: 10px; }
        .btn-back:hover { background: #dc2626; }

        .tip { font-size: 11px; color: #888; margin-top: 10px; }

        .btn-video { background: #8b5cf6; color: white; }
        .btn-video:hover { background: #7c3aed; }
        .btn-video:disabled { background: #ccc; cursor: not-allowed; }

        .video-preview {
            display: none;
            background: #1e293b;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 15px;
        }
        .video-preview.show { display: block; }
        .video-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            font-size: 12px;
            margin-bottom: 10px;
        }
        .btn-remove {
            background: #ef4444;
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .video-preview video {
            width: 100%;
            max-height: 150px;
            border-radius: 8px;
            background: #000;
        }
        .btn-analyze {
            width: 100%;
            margin-top: 10px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        .btn-analyze:hover { background: #059669; }
        .btn-analyze:disabled { background: #ccc; cursor: not-allowed; }

        .input-area { display: none; }
        .input-area.show { display: block; }

        .illustration { text-align: center; }
        .illustration img { width: 100%; max-width: 350px; border-radius: 12px; }
        .illustration .pill {
            display: inline-block;
            background: #00cccc;
            color: #022c22;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
        }
        .illustration h3 { font-size: 14px; margin-top: 10px; }
        .illustration p { font-size: 12px; color: #666; }

        .footer { text-align: center; color: rgba(255,255,255,0.6); font-size: 11px; margin-top: 20px; }

        @media (max-width: 800px) {
            .card { grid-template-columns: 1fr; }
            .modules { grid-template-columns: 1fr 1fr; }
            .submods { grid-template-columns: 1fr 1fr; }
            .input-row { flex-wrap: wrap; }
            .btn { width: 100%; margin-top: 5px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <img src="https://www.storopack.com.br/fileadmin/_processed_/4/9/csm_Storopack_Imagefilm_Thumbnail_118bf988a8.jpg" class="logo" alt="Storopack">
                <div>
                    <div class="header-title">STOROPACK</div>
                    <div class="header-sub">Assistente Tecnico de Embalagens</div>
                </div>
            </div>
            <div class="header-right">
                <div class="status">‚óè Assistente Online</div>
                <div class="phone">Contato: <b>+55 11 5677 4699</b></div>
            </div>
        </div>

        <div class="card">
            <div>
                <h1>Central de Suporte Storopack</h1>
                <p class="subtitle">Atendimento inteligente para d√∫vidas t√©cnicas.</p>

                <div class="badge" id="badge">
                    <span id="badgeText"></span>
                    <button id="btnVoltar">‚Üê Voltar</button>
                </div>

                <div class="hint" id="hint">Selecione o equipamento sobre o qual deseja suporte:</div>

                <div class="chat" id="chat"></div>

                <div class="input-area" id="inputArea">
                <div class="video-preview" id="videoPreview">
                    <div class="video-header">
                        <span>üìπ V√≠deo selecionado</span>
                        <button class="btn-remove" id="btnRemoveVideo">‚úï</button>
                    </div>
                    <video id="videoPlayer" controls></video>
                    <button class="btn btn-analyze" id="btnAnalyze">üîç Analisar V√≠deo com IA</button>
                </div>

                <div class="input-row">
                    <input type="text" id="msgInput" placeholder="Selecione um equipamento acima..." disabled>
                    <input type="file" id="videoInput" accept="video/*" style="display:none">
                    <button class="btn btn-video" id="btnVideo" disabled>üìπ V√≠deo</button>
                    <button class="btn btn-primary" id="btnSend" disabled>Enviar ‚û§</button>
                </div>
                <div class="tip">üí° Envie um v√≠deo do erro para an√°lise autom√°tica pela IA!</div>
                </div>
            </div>

            <div class="illustration">
                <img src="https://media.licdn.com/dms/image/v2/D4D05AQHQVQD99MOOug/videocover-low/B4DZoVhdqdK0B4-/0/1761297687645?e=2147483647&v=beta&t=FzJaplIJOhL1snkcWii_p3X9dPGyaSw1hjupd_3URvE" alt="Assistente">
                <div class="pill">‚óè Suporte t√©cnico imediato</div>
                <h3>Assistente de Manuten√ß√£o</h3>
                <p>Orienta√ß√µes r√°pidas baseadas em manuais t√©cnicos.</p>
            </div>
        </div>

        <div class="footer">¬© Storopack - Assistente T√©cnico (beta)</div>
    </div>

<script>
var moduloAtivo = null;
var submoduloAtivo = null;

var chat = document.getElementById('chat');
var msgInput = document.getElementById('msgInput');
var btnSend = document.getElementById('btnSend');
var btnVoltar = document.getElementById('btnVoltar');
var btnVideo = document.getElementById('btnVideo');
var videoInput = document.getElementById('videoInput');
var videoPreview = document.getElementById('videoPreview');
var videoPlayer = document.getElementById('videoPlayer');
var btnRemoveVideo = document.getElementById('btnRemoveVideo');
var btnAnalyze = document.getElementById('btnAnalyze');
var badge = document.getElementById('badge');
var badgeText = document.getElementById('badgeText');
var hint = document.getElementById('hint');
var inputArea = document.getElementById('inputArea');

var videoFile = null;

var modulos = {
    airplus: {
        nome: 'AIRplus',
        img: 'https://img.directindustry.com/pt/images_di/photo-g/34409-10167740.webp',
        subs: null
    },
    airmove: {
        nome: 'AIRmove',
        img: 'https://www.storopack.com.br/fileadmin/_processed_/7/e/csm_PP_AP_AIRmove___machine_front_motive2_cushion_film_low_res_300dpi_061fd19c2b.jpg',
        subs: {
            'AIRmove 1': 'https://www.storopack.com.br/fileadmin/_processed_/7/e/csm_PP_AP_AIRmove___machine_front_motive2_cushion_film_low_res_300dpi_061fd19c2b.jpg',
            'AIRmove 2': 'https://www.storopack.com.br/fileadmin/_processed_/7/e/csm_PP_AP_AIRmove___machine_front_motive2_cushion_film_low_res_300dpi_061fd19c2b.jpg'
        }
    },
    paperplus: {
        nome: 'PAPERplus',
        img: 'https://www.storopack.com.br/fileadmin/_processed_/1/e/csm_PP_PP_Classic_CX_machine_0539_1280x580px_EUROPEAN_STAND_b213d265e2.png',
        subs: {
            'Shooter': 'https://www.storopack.com.br/fileadmin/_processed_/5/9/csm_PP_PP_Shooter_machine_tablestand_motive_1_1280x580px_6913698898.png',
            'Papillon': 'https://www.storopack.com.br/fileadmin/_processed_/c/a/csm_PP_PP_Papillon_machine_tablestand_motive1_1280x580px_b746b18c6a.png',
            'Classic': 'https://img.directindustry.com/pt/images_di/photo-g/34409-12098453.webp',
            'Track': 'https://swiftpak.imgix.net/uploads/Products/Papertech/16_12904_a.jpg',
            'CX': 'https://www.storopack.com.br/fileadmin/_processed_/1/e/csm_PP_PP_Classic_CX_machine_0539_1280x580px_EUROPEAN_STAND_b213d265e2.png',
            'Coiler': 'https://www.storopack.com.br/fileadmin/_processed_/1/4/csm_PP_PP_Coiler2_Classic_CX_machine_1985_low_res_1280x580px_6e072a7d32.png'
        }
    },
    foamplus: {
        nome: 'FOAMplus',
        img: 'https://www.storopack.com.br/fileadmin/_processed_/1/9/csm_PP_FP_Bag_Packer3_machine_6327_1280x580px_277b779f5d.png',
        subs: {
            'Bagpacker': 'https://www.storopack.com.br/fileadmin/_processed_/1/9/csm_PP_FP_Bag_Packer3_machine_6327_1280x580px_277b779f5d.png',
            'Handpacker': 'https://5.imimg.com/data5/HS/KC/MW/SELLER-8794370/foamplus-hand-packer-2-machine-1000x1000.jpg'
        }
    }
};

function addMsg(texto, isUser) {
    var div = document.createElement('div');
    div.className = 'msg ' + (isUser ? 'msg-user' : 'msg-bot');
    var span = document.createElement('span');
    span.innerHTML = texto.replace(/\n/g, '<br>');
    div.appendChild(span);
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

function mostrarModulos() {
    var container = document.createElement('div');
    container.className = 'modules';
    
    for (var key in modulos) {
        var btn = document.createElement('button');
        btn.className = 'mod-btn ' + key;
        btn.setAttribute('data-modulo', key);
        btn.innerHTML = '<img src="' + modulos[key].img + '"><div class="label">' + modulos[key].nome + '</div>';
        btn.addEventListener('click', function() {
            clicarModulo(this.getAttribute('data-modulo'));
        });
        container.appendChild(btn);
    }
    
    var wrapper = document.createElement('div');
    wrapper.className = 'msg msg-bot';
    wrapper.appendChild(container);
    chat.appendChild(wrapper);
    chat.scrollTop = chat.scrollHeight;
}

function clicarModulo(key) {
    var mod = modulos[key];
    if (mod.subs) {
        mostrarSubmodulos(key);
    } else {
        ativarModulo(key, null);
    }
}

function mostrarSubmodulos(key) {
    var mod = modulos[key];
    chat.innerHTML = '';
    addMsg('Ol√°! Selecione o modelo de <b>' + mod.nome + '</b>:');
    
    var container = document.createElement('div');
    container.className = 'submods';
    
    for (var nome in mod.subs) {
        var btn = document.createElement('button');
        btn.className = 'sub-btn';
        btn.setAttribute('data-modulo', key);
        btn.setAttribute('data-sub', nome);
        btn.innerHTML = '<img src="' + mod.subs[nome] + '"><div class="label">' + nome + '</div>';
        btn.addEventListener('click', function() {
            ativarModulo(this.getAttribute('data-modulo'), this.getAttribute('data-sub'));
        });
        container.appendChild(btn);
    }
    
    var voltarBtn = document.createElement('button');
    voltarBtn.className = 'btn btn-back';
    voltarBtn.textContent = '‚Üê Voltar aos equipamentos';
    voltarBtn.addEventListener('click', voltar);
    
    var wrapper = document.createElement('div');
    wrapper.className = 'msg msg-bot';
    wrapper.appendChild(container);
    wrapper.appendChild(voltarBtn);
    chat.appendChild(wrapper);
    chat.scrollTop = chat.scrollHeight;
    
    hint.innerHTML = '<b>' + mod.nome + '</b> - Escolha o modelo:';
}

function ativarModulo(key, sub) {
    moduloAtivo = key;
    submoduloAtivo = sub;
    var mod = modulos[key];
    var nome = sub ? mod.nome + ' ' + sub : mod.nome;
    
    badge.className = 'badge show ' + key;
    badgeText.textContent = 'M√≥dulo: ' + nome;
    
    hint.innerHTML = '<b>' + nome + '</b> - Descreva o problema:';
    
    msgInput.disabled = false;
    msgInput.placeholder = 'Descreva o problema (ex: erro E3, travamento...)';
    btnSend.disabled = false;
    btnVideo.disabled = false;
    inputArea.className = 'input-area show';
    
    chat.innerHTML = '';
    addMsg('Voc√™ selecionou <b>' + nome + '</b>.\n\nüìπ Envie um v√≠deo do erro OU descreva o problema.');
    
    msgInput.focus();
}

function selecionarVideo() {
    videoInput.click();
}

function videoSelecionado(e) {
    var file = e.target.files[0];
    if (file) {
        videoFile = file;
        videoPlayer.src = URL.createObjectURL(file);
        videoPreview.className = 'video-preview show';
    }
}

function removerVideo() {
    videoFile = null;
    videoInput.value = '';
    videoPlayer.src = '';
    videoPreview.className = 'video-preview';
}

function analisarVideo() {
    if (!videoFile || !moduloAtivo) {
        alert('Selecione um equipamento e um v√≠deo primeiro.');
        return;
    }
    
    addMsg('üìπ [V√≠deo enviado para an√°lise]', true);
    btnAnalyze.disabled = true;
    btnAnalyze.textContent = '‚è≥ Analisando...';
    
    var formData = new FormData();
    formData.append('video', videoFile);
    formData.append('modulo', moduloAtivo + (submoduloAtivo ? '_' + submoduloAtivo.toLowerCase().replace(/ /g, '_') : ''));
    formData.append('descricao', msgInput.value.trim());
    
    fetch('/analyze-video', {
        method: 'POST',
        body: formData
    })
    .then(function(r) { return r.json(); })
    .then(function(data) {
        addMsg(data.resposta || 'Erro ao analisar v√≠deo.');
        removerVideo();
    })
    .catch(function(err) {
        addMsg('Erro de conex√£o. Tente novamente ou descreva o problema por texto.');
        removerVideo();
    })
    .finally(function() {
        btnAnalyze.disabled = false;
        btnAnalyze.textContent = 'üîç Analisar V√≠deo com IA';
    });
}

function voltar() {
    moduloAtivo = null;
    submoduloAtivo = null;
    removerVideo();
    
    badge.className = 'badge';
    hint.textContent = 'Selecione o equipamento sobre o qual deseja suporte:';
    msgInput.disabled = true;
    msgInput.placeholder = 'Selecione um equipamento acima...';
    msgInput.value = '';
    btnSend.disabled = true;
    btnVideo.disabled = true;
    inputArea.className = 'input-area';
    
    chat.innerHTML = '';
    addMsg('Ol√°! Sou o assistente t√©cnico da Storopack. Como posso ajudar?');
    mostrarModulos();
}

function enviar() {
    var texto = msgInput.value.trim();
    if (!texto || !moduloAtivo) return;
    
    addMsg(texto, true);
    msgInput.value = '';
    btnSend.disabled = true;
    
    var modulo = moduloAtivo;
    if (submoduloAtivo) {
        modulo += '_' + submoduloAtivo.toLowerCase().replace(/ /g, '_');
    }
    
    fetch('/chat', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({mensagem: texto, modulo: modulo})
    })
    .then(function(r) { return r.json(); })
    .then(function(data) {
        addMsg(data.resposta || 'Erro ao processar.');
        btnSend.disabled = false;
        msgInput.focus();
    })
    .catch(function(err) {
        addMsg('Erro de conex√£o. Tente novamente.');
        btnSend.disabled = false;
    });
}

// Event listeners
btnSend.addEventListener('click', enviar);
btnVoltar.addEventListener('click', voltar);
btnVideo.addEventListener('click', selecionarVideo);
videoInput.addEventListener('change', videoSelecionado);
btnRemoveVideo.addEventListener('click', removerVideo);
btnAnalyze.addEventListener('click', analisarVideo);
msgInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') enviar();
});

// Inicializa
voltar();
</script>
</body>
</html>
